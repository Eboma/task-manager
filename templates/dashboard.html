{% extends 'base.html'  %}

{% block title %} Home Page {% endblock %}

{% block body %}

<div class='container-fluid mt-3'>
  <div class="row col-sm-12 col-md-12 col-lg-12">
    <p >Welcome: <strong>{{ username | title }},</strong> </p>
  </div>
</div>

<div class='container text-center mt-5'>
  <div class="row col-sm-12 col-md-12 col-lg-12">
    <h1>Your Task Manager</h1>
  </div>
</div>

<div class="justify-content-center text-center mt-5">
<a href="#" class="btn btn-success btn-lg border-0" data-bs-toggle="modal" data-bs-target="#addtaskmodal"/>Add Task</a>
</div>


<!--Add Task Modal Begin -->
<div class="modal" id="addtaskmodal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Add Task</h4>
        <button type="button" class="btn-close bg-danger" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <form action="{{ url_for('dashboard') }}" method="POST">
          {{ form.hidden_tag() }}

          <div class="mb-3">
            {{ form.title.label(class="form-label fw-bold") }}
            {{ form.title(class="form-control", placeholder="Enter your title") }}
          </div>

          <div class="mb-3">
            {{ form.description.label(class="form-label fw-bold") }}
            {{ form.description(class="form-control", placeholder="Enter your description") }}
          </div>

          <div class="mb-3">
            {{ form.status.label(class="form-label fw-bold") }}
            {{ form.status(class="form-control") }}
          </div>
          <div class="mb-3">
            {{ form.due_date.label(class="form-label fw-bold") }}
            {{ form.due_date(class="form-control") }}
          </div>

          <div class="d-grid">
            {{ form.submit(class="btn l-btn btn-lg") }}
          </div>
          
        </form>
      </div>


    </div>
  </div>
</div>
<!--Add Task Modal end -->



<div class="container mt-5">
  <div class="row">
    <div class="col-12">
      <h1>Tasks:</h1>
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th>Title</th>
              <th>Status</th>
              <th>Created</th>
              <th>Due</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if tasks %}
               {% for task in tasks %}
                 <tr>
                   <td>{{ task.title | title }}</td>
                   <td class="text-warning fw-bold">{{ task.status }}</td>
                   <td>{{ task.date_created.strftime('%Y-%m-%d') }}</td>
                   <td>{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '' }}</td>
                   <td>
                       <div class="btn-group" role="group">
                           <a href="{{ url_for('taskdetails', task_id=task.id)}}" 
                              class="btn btn-info btn-sm">Details</a>
                         <button type="button" class="btn btn-primary btn-sm"
                                 data-bs-toggle="modal"
                                 data-bs-target="#editModal-{{ task.id }}">
                           Edit
                         </button>
                           <form action="{{ url_for('delete_task', task_id=task.id)}}" method="POST">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this task?')">Delete</button>
                           </form>
                           </div>
                  </td>
                 </tr>
            <!--Edit Modal Start -->
          


            <div class="modal" id="editModal-{{ task.id }}">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                  <!-- Modal Header -->
                  <div class="modal-header">
                    <h4 class="modal-title">Add Task</h4>
                    <button type="button" class="btn-close bg-danger" data-bs-dismiss="modal"></button>
                  </div>

                  <!-- Modal body -->
                  <div class="modal-body">
                    <form action="{{ url_for('edittask', task_id=task.id )}}" method="POST">
                      {{ form.hidden_tag() }}

                      <div class="mb-3">
                        {{ form.title.label(class="form-label fw-bold") }}
                        {{ form.title(class="form-control", value=task.title) }}
                      </div>

                      <div class="mb-3">
                        {{ form.description.label(class="form-label fw-bold") }}
                        {{ form.description(class="form-control", value=task.description) }}
                      </div>

                      <div class="mb-3">
                        {{ form.status.label(class="form-label fw-bold") }}
                        {{ form.status(class="form-control") }}
                      </div>
                      <div class="mb-3">
                        {{ form.due_date.label(class="form-label fw-bold") }}
                        {{ form.due_date(class="form-control") }}
                      </div>

                      <div class="d-grid">
                        {{ form.submit(class="btn l-btn btn-lg") }}
                      </div>

                    </form>
                  </div>
                 </div>
              </div>
            </div>

            <!-- End Edit Modal -->

               {% endfor %}
            {% else %}
                <tr>
                  <td class="text-center" colspan="5">No Available Task</td>
                </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


{% endblock %}